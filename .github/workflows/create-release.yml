name: Create release branches

on:
  workflow_dispatch:
    inputs:
      release:
        required: true
      base:
        default: main

permissions:
  contents: write

jobs:
  create:
    runs-on: ubuntu-latest
    steps:
      - name: Create branch
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          OWNER=${{ github.repository_owner }}
          BASE=${{ inputs.base }}
          RELEASE=${{ inputs.release }}

          SHA=$(gh api "repos/$OWNER/service-a/git/ref/heads/$BASE" --jq .object.sha)

          gh api "repos/$OWNER/service-a/git/refs" \
            -f ref="refs/heads/release/$RELEASE" \
            -f sha="$SHA"

